<!DOCTYPE html>
<html lang="zh-CN" class="no-js">
<head>
  <meta charset="UTF-8">
  <base href="http://blog.pytool.com/">
<title>Haproxy Start </title>

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

<meta name="description" content="目录： HAProxy 是什么 HAProxy 的核心能力和关键特性 HAProxy 的安装和运行 使用 HAProxy 搭建 L7 负载均衡器 使用 HAProxy 搭建 L4 负载均衡器 HAProxy 关键配置详解 使用 Keepalived 实现 HAProxy 高可用 HAProxy 是什么 HAProxy 是一">
<meta name="author" content=rinetd>
<meta name="publisher" content=rinetd@163.com>

<meta itemprop="name" content="Haproxy Start - 时光小栈">
<meta itemprop="description" content="目录： HAProxy 是什么 HAProxy 的核心能力和关键特性 HAProxy 的安装和运行 使用 HAProxy 搭建 L7 负载均衡器 使用 HAProxy 搭建 L4 负载均衡器 HAProxy 关键配置详解 使用 Keepalived 实现 HAProxy 高可用 HAProxy 是什么 HAProxy 是一">
<meta itemprop="image" content="http://blog.pytool.com/public/avatar.png">

<meta property="og:type" content="article" />
<meta property="og:title" content="Haproxy Start - 时光小栈" />
<meta property="og:description" content="目录： HAProxy 是什么 HAProxy 的核心能力和关键特性 HAProxy 的安装和运行 使用 HAProxy 搭建 L7 负载均衡器 使用 HAProxy 搭建 L4 负载均衡器 HAProxy 关键配置详解 使用 Keepalived 实现 HAProxy 高可用 HAProxy 是什么 HAProxy 是一">
<meta property="og:image" content="http://blog.pytool.com/public/avatar.png" />
<meta property="og:url" content="http://blog.pytool.com/linux/haproxy/haproxy-start/" />

<meta name="baidu-site-verification" content="pCInWQYbNT" />
<meta name="google-site-verification" content="ifeWsnNpU7w8vP3ii_Cjq-P9LKw3ngVitnMWv4XmJqk" />


<link rel="canonical" href="../../../linux/haproxy/haproxy-start/">
<link rel='shortlink' href="http://blog.pytool.com/linux/haproxy/haproxy-start/"/>
<link rel="shortcut icon" href="../../../public/favicon.ico"/>

<link rel="stylesheet" id="human-style-css" href="../../../wp-content/themes/hueman/style.css" type="text/css" media="all"/>
<link rel="stylesheet" id="human-style-css1" href="../../../wp-content/themes/hueman/custom.css" type="text/css" media="all"/>
<link rel="stylesheet" id="human-style-css2" href="../../../wp-content/themes/hueman-child/style.css" type="text/css" media="all"/>
<link rel="stylesheet" id="responsive-css" href="../../../wp-content/themes/hueman/responsive.css" type="text/css" media="all"/>
<link rel="stylesheet" id="font-awesome-css" href="../../../wp-content/themes/hueman/fonts/font-awesome.min.css" type="text/css" media="all"/>

<link rel="stylesheet" href="../../../public/highlight/styles/github.css">
<link rel="stylesheet" id="human-style-css3" href="../../../wp-content/themes/hueman-child/user.css" type="text/css" media="all"/>
<link rel="stylesheet" href="../../../public/font/hack/css/hack.min.css">



</head>
<body class="single single-post single-format-standard col-3cm full-width topbar-enabled chrome">
<div id="wrapper">
  <header id="header">

  <nav class="nav-container group" id="nav-topbar">
    
    <div class="nav-text"></div>
    <div class="nav-wrap container">
      <a rel="nofollow" href="http://blog.pytool.com/" class="nav-cs-icon">
        <img width="40" height="40" src="../../../public/avatar.png" alt="rinetd" title="Home">
      </a>

      <ul id="menu-default-menu" class="nav container-inner group">
        <li class="menu-item menu-item-type-post_type menu-item-object-page"><a rel="nofollow" href="../../../">Home</a></li>
          
            
              <li class="menu-item menu-item-type-post_type menu-item-object-page">
                <a rel="nofollow" href="../../../awesome/">Awesome </a>
                
                  
              </li>
                    
          
            
              <li class="menu-item menu-item-type-post_type menu-item-object-page">
                <a rel="nofollow" href="../../../basic/">Basic </a>
                
                  
              </li>
                    
          
            
              <li class="menu-item menu-item-type-post_type menu-item-object-page">
                <a rel="nofollow" href="../../../database/">Database </a>
                
                           
                  <ul>
                        
                        <li >
                          <a href="http://blog.pytool.com/database/mongo/">Mongo</a>
                          
                        </li>                
                        
                        <li >
                          <a href="http://blog.pytool.com/database/mysql/">Mysql</a>
                          
                        </li>                
                        
                        <li >
                          <a href="http://blog.pytool.com/database/redis/">Redis</a>
                          
                        </li>                
                      
                    </ul>
                  
              </li>
                    
          
            
              <li class="menu-item menu-item-type-post_type menu-item-object-page">
                <a rel="nofollow" href="../../../devops/">Devops </a>
                
                           
                  <ul>
                        
                        <li >
                          <a href="http://blog.pytool.com/devops/oauth2/">OAuth2</a>
                          
                        </li>                
                        
                        <li >
                          <a href="http://blog.pytool.com/devops/ansible/">Ansible</a>
                          
                        </li>                
                        
                        <li >
                          <a href="http://blog.pytool.com/devops/docker/">Docker</a>
                          
                        </li>                
                        
                        <li >
                          <a href="http://blog.pytool.com/devops/drone/">Drone</a>
                          
                        </li>                
                        
                        <li >
                          <a href="http://blog.pytool.com/devops/elk/">Elk</a>
                          
                        </li>                
                        
                        <li >
                          <a href="http://blog.pytool.com/devops/etcd/">Etcd</a>
                          
                        </li>                
                        
                        <li >
                          <a href="http://blog.pytool.com/devops/kubernetes/">Kubernetes</a>
                          
                        </li>                
                        
                        <li >
                          <a href="http://blog.pytool.com/devops/prometheus/">Prometheus</a>
                          
                        </li>                
                        
                        <li >
                          <a href="http://blog.pytool.com/devops/%E6%96%87%E6%A1%A3%E7%94%9F%E6%88%90%E5%99%A8/">文档生成器</a>
                          
                        </li>                
                        
                        <li >
                          <a href="http://blog.pytool.com/devops/%E7%B3%BB%E7%BB%9F%E7%9B%91%E6%8E%A7/">系统监控</a>
                          
                        </li>                
                        
                        <li >
                          <a href="http://blog.pytool.com/devops/%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2/">自动部署</a>
                          
                        </li>                
                      
                    </ul>
                  
              </li>
                    
          
            
              <li class="menu-item menu-item-type-post_type menu-item-object-page">
                <a rel="nofollow" href="../../../edit/">Edit </a>
                
                  
              </li>
                    
          
            
              <li class="menu-item menu-item-type-post_type menu-item-object-page">
                <a rel="nofollow" href="../../../frontend/">Frontend </a>
                
                           
                  <ul>
                        
                        <li >
                          <a href="http://blog.pytool.com/frontend/vue/">Vue</a>
                          
                        </li>                
                      
                    </ul>
                  
              </li>
                    
          
            
              <li class="menu-item menu-item-type-post_type menu-item-object-page">
                <a rel="nofollow" href="../../../hacker/">Hacker </a>
                
                  
              </li>
                    
          
            
              <li class="menu-item menu-item-type-post_type menu-item-object-page">
                <a rel="nofollow" href="../../../hardware/">Hardware </a>
                
                           
                  <ul>
                        
                        <li >
                          <a href="http://blog.pytool.com/hardware/%E8%BD%A6%E8%81%94%E7%BD%91/">车联网</a>
                          
                        </li>                
                      
                    </ul>
                  
              </li>
                    
          
            
              <li class="menu-item menu-item-type-post_type menu-item-object-page">
                <a rel="nofollow" href="../../../language/">Language </a>
                
                           
                  <ul>
                        
                        <li >
                          <a href="http://blog.pytool.com/language/android/">Android</a>
                          
                        </li>                
                        
                        <li >
                          <a href="http://blog.pytool.com/language/golang/">Golang</a>
                          
                        </li>                
                        
                        <li >
                          <a href="http://blog.pytool.com/language/php/">Php</a>
                          
                        </li>                
                        
                        <li >
                          <a href="http://blog.pytool.com/language/python/">Python</a>
                          
                        </li>                
                      
                    </ul>
                  
              </li>
                    
          
            
              <li class="menu-item menu-item-type-post_type menu-item-object-page">
                <a rel="nofollow" href="../../../linux/">Linux </a>
                
                           
                  <ul>
                        
                        <li >
                          <a href="http://blog.pytool.com/linux/cmd/">Cmd</a>
                          
                        </li>                
                        
                        <li >
                          <a href="http://blog.pytool.com/linux/haproxy/">Haproxy</a>
                          
                        </li>                
                        
                        <li >
                          <a href="http://blog.pytool.com/linux/ip/">Ip</a>
                          
                        </li>                
                        
                        <li >
                          <a href="http://blog.pytool.com/linux/lvs/">Lvs</a>
                          
                        </li>                
                        
                        <li >
                          <a href="http://blog.pytool.com/linux/nginx/">Nginx</a>
                          
                        </li>                
                        
                        <li >
                          <a href="http://blog.pytool.com/linux/shell/">Shell</a>
                          
                        </li>                
                      
                    </ul>
                  
              </li>
                    
          
            
              <li class="menu-item menu-item-type-post_type menu-item-object-page">
                <a rel="nofollow" href="../../../math/">Math </a>
                
                  
              </li>
                    
          
                    
          
            
              <li class="menu-item menu-item-type-post_type menu-item-object-page">
                <a rel="nofollow" href="../../../software/">Software </a>
                
                  
              </li>
                    
          
            
              <li class="menu-item menu-item-type-post_type menu-item-object-page">
                <a rel="nofollow" href="../../../wiki/">Wiki </a>
                
                  
              </li>
                    
          
            
              <li class="menu-item menu-item-type-post_type menu-item-object-page">
                <a rel="nofollow" href="../../../windows/">Windows </a>
                
                  
              </li>
                    
          
       
        
        <li class="menu-item menu-item-type-post_type menu-item-object-page">
          <a rel="nofollow" href="../../../me/">about</a>
        </li>
        

        
      </ul>

    </div>

    
    
    

  </nav>
  

  
  

</header>



  <div class="container" id="page">
    <div class="container-inner">
      <div class="main">
        <div class="main-inner group">
          <section class="content">
            <div class="page-title pad group">
              <ul class="meta-single group">
                
                <li><span class="fa fa-folder-open"></span></li>
                
                <li class="category">
                  <a rel="nofollow" href="../../../categories/devops/" rel="category tag">devops</a>
                </li>
                    
                
                <li><span class="fa fa-tags"></span></li>
                
                  <li><a href="../../../tags/haproxy">HAProxy</a> </li>
                
              </ul>
            </div>
            <div class="pad group">

              <article
                  class="post type-post status-publish format-standard has-post-thumbnail hentry category-australien tag-bondi-beach tag-city2surf tag-sydney">
                <div class="post-inner group">

                  <h1 class="post-title">Haproxy Start</h1>

                  <p class="post-byline">
                    by  · 2018年03月12日 · 8176 Words ·
                    ~17min reading time |
                    
                    
                    <a rel="nofollow" href="https://gitlab.com/rinetd/blog/edit/master/linux/haproxy/haproxy-start.md" target="_blank">Improve on <i class="fa fa-gitlab"></i></a>
                  </p>

                  <div class="clear"></div>

                  <div class="entry">
                    <div class="entry-inner">
                      
                      <p>作者：<a target="_blank" href="http://blog.pytool.com/">rinetd</a>
                      </br>原文链接：<a target="_blank" href="http://blog.pytool.com/linux/haproxy/haproxy-start/"> Haproxy Start</a> </p>
                      

<p>目录：</p>

<pre><code>HAProxy 是什么
HAProxy 的核心能力和关键特性
HAProxy 的安装和运行
使用 HAProxy 搭建 L7 负载均衡器
使用 HAProxy 搭建 L4 负载均衡器
HAProxy 关键配置详解
使用 Keepalived 实现 HAProxy 高可用
</code></pre>

<p>HAProxy 是什么</p>

<p>HAProxy 是一个免费的负载均衡软件，可以运行于大部分主流的 Linux 操作系统上。</p>

<p>HAProxy 提供了 L4(TCP) 和 L7(HTTP) 两种负载均衡能力，具备丰富的功能。HAProxy 的社区非常活跃，版本更新快速（最新稳定版 1.7.2 于 2017/01/13 推出）。最关键的是，HAProxy 具备媲美商用负载均衡器的性能和稳定性。</p>

<p>因为 HAProxy 的上述优点，它当前不仅仅是免费负载均衡软件的首选，更几乎成为了唯一选择。<br />
HAProxy 的核心能力和关键特性<br />
HAProxy 的核心功能</p>

<pre><code>负载均衡：L4 和 L7 两种模式，支持 RR / 静态 RR/LC/IP Hash/URI Hash/URL_PARAM Hash/HTTP_HEADER Hash 等丰富的负载均衡算法
健康检查：支持 TCP 和 HTTP 两种健康检查模式
会话保持：对于未实现会话共享的应用集群，可通过 Insert Cookie/Rewrite Cookie/Prefix Cookie，以及上述的多种 Hash 方式实现会话保持
SSL：HAProxy 可以解析 HTTPS 协议，并能够将请求解密为 HTTP 后向后端传输
HTTP 请求重写与重定向
监控与统计：HAProxy 提供了基于 Web 的统计信息页面，展现健康状态和流量数据。基于此功能，使用者可以开发监控程序来监控 HAProxy 的状态
</code></pre>

<p>HAProxy 的关键特性</p>

<p>性能</p>

<pre><code>采用单线程、事件驱动、非阻塞模型，减少上下文切换的消耗，能在 1ms 内处理数百个请求。并且每个会话只占用数 KB 的内存。
大量精细的性能优化，如 O(1) 复杂度的事件检查器、延迟更新技术、Single-buffereing、Zero-copy forwarding 等等，这些技术使得 HAProxy 在中等负载下只占用极低的 CPU 资源。
HAProxy 大量利用操作系统本身的功能特性，使得其在处理请求时能发挥极高的性能，通常情况下，HAProxy 自身只占用 15% 的处理时间，剩余的 85% 都是在系统内核层完成的。
HAProxy 作者在 8 年前（2009）年使用 1.4 版本进行了一次测试，单个 HAProxy 进程的处理能力突破了 10 万请求 / 秒，并轻松占满了 10Gbps 的网络带宽。
</code></pre>

<p>稳定性</p>

<p>作为建议以单进程模式运行的程序，HAProxy 对稳定性的要求是十分严苛的。按照作者的说法，HAProxy 在 13 年间从未出现过一个会导致其崩溃的 BUG，HAProxy 一旦成功启动，除非操作系统或硬件故障，否则就不会崩溃（我觉得可能多少还是有夸大的成分）。</p>

<p>在上文中提到过，HAProxy 的大部分工作都是在操作系统内核完成的，所以 HAProxy 的稳定性主要依赖于操作系统，作者建议使用 2.6 或 3.x 的 Linux 内核，对 sysctls 参数进行精细的优化，并且确保主机有足够的内存。这样 HAProxy 就能够持续满负载稳定运行数年之久。</p>

<p>个人的建议：</p>

<pre><code>使用 3.x 内核的 Linux 操作系统运行 HAProxy
运行 HAProxy 的主机上不要部署其他的应用，确保 HAProxy 独占资源，同时避免其他应用引发操作系统或主机的故障
至少为 HAProxy 配备一台备机，以应对主机硬件故障、断电等突发情况（搭建双活 HAProxy 的方法在后文中有描述）
sysctl 的建议配置（并不是万用配置，仍然需要针对具体情况进行更精细的调整，但可以作为首次使用 HAProxy 的初始配置使用）：
</code></pre>

<pre><code class="language-ini">net.ipv4.tcp_tw_reuse = 1
net.ipv4.ip_local_port_range = 1024 65023
net.ipv4.tcp_max_syn_backlog = 10240
net.ipv4.tcp_max_tw_buckets = 400000
net.ipv4.tcp_max_orphans = 60000
net.ipv4.tcp_synack_retries = 3
net.core.somaxconn = 10000
</code></pre>

<p>HAProxy 的安装和运行</p>

<p>下面介绍在 CentOS7 中安装和运行 HAProxy 最新稳定版 (1.7.2) 的方法<br />
安装</p>

<pre><code>为 HAProxy 创建用户和用户组，此例中用户和用户组都是 &quot;ha&quot;。注意，如果想要让 HAProxy 监听 1024 以下的端口，则需要以 root 用户来启动

下载并解压
</code></pre>

<p>wget <a href="http://www.haproxy.org/download/1.7/src/haproxy-1.7.2.tar.gz" target="_blank">http://www.haproxy.org/download/1.7/src/haproxy-1.7.2.tar.gz</a><br />
tar -xzf haproxy-1.7.2.tar.gz</p>

<pre><code>编译并安装
</code></pre>

<p>make PREFIX=/home/ha/haproxy TARGET=linux2628<br />
make install PREFIX=/home/ha/haproxy</p>

<p>PREFIX 为指定的安装路径，TARGET 则根据当前操作系统内核版本指定：</p>

<ul>
<li>linux22     for Linux 2.2<br /></li>
<li>linux24     for Linux 2.4 and above (default)<br /></li>
<li>linux24e    for Linux 2.4 with support for a working epoll (&gt; 0.21)<br /></li>
<li>linux26     for Linux 2.6 and above<br /></li>
<li>linux2628   for Linux 2.6.28, 3.x, and above (enables splice and tproxy)<br />
<br /></li>
</ul>

<p>此例中，我们的操作系统内核版本为 3.10.0，所以 TARGET 指定为 linux2628</p>

<pre><code>创建 HAProxy 配置文件
</code></pre>

<p>mkdir -p /home/ha/haproxy/conf<br />
vi /home/ha/haproxy/conf/haproxy.cfg</p>

<p>我们先创建一个最简单配置文件：</p>

<pre><code class="language-yaml">global #全局属性
    daemon  #以 daemon 方式在后台运行
    maxconn 256  #最大同时 256 连接
    pidfile /home/ha/haproxy/conf/haproxy.pid  #指定保存 HAProxy 进程号的文件

defaults #默认参数
    mode http  #http 模式
    timeout connect 5000ms  #连接 server 端超时 5s
    timeout client 50000ms  #客户端响应超时 50s
    timeout server 50000ms  #server 端响应超时 50s

frontend http-in #前端服务 http-in
    bind *:8080  #监听 8080 端口
    default_backend servers  #请求转发至名为 &quot;servers&quot; 的后端服务

backend servers #后端服务 servers
    server server1 127.0.0.1:8000 maxconn 32  #backend servers 中只有一个后端服务，名字叫 server1，起在本机的 8000 端口，HAProxy 同时最多向这个服务发起 32 个连接
</code></pre>

<p>更加详细的配置会在后面章节中进行说明<br />
注意：HAProxy 要求系统的 ulimit -n 参数大于 [maxconn*2+18]，在设置较大的 maxconn 时，注意检查并修改 ulimit -n 参数</p>

<pre><code>将 HAProxy 注册为系统服务
</code></pre>

<p>在 / etc/init.d 目录下添加 HAProxy 服务的启停脚本：</p>

<p>vi /etc/init.d/haproxy</p>

<pre><code class="language-bash">#! /bin/sh
set -e

PATH=/sbin:/bin:/usr/sbin:/usr/bin:/home/ha/haproxy/sbin
PROGDIR=/home/ha/haproxy
PROGNAME=haproxy
DAEMON=$PROGDIR/sbin/$PROGNAME
CONFIG=$PROGDIR/conf/$PROGNAME.cfg
PIDFILE=$PROGDIR/conf/$PROGNAME.pid
DESC=&quot;HAProxy daemon&quot;
SCRIPTNAME=/etc/init.d/$PROGNAME

# Gracefully exit if the package has been removed.
test -x $DAEMON || exit 0

start()
{
       echo -e &quot;Starting $DESC: $PROGNAME\n&quot;
       $DAEMON -f $CONFIG
       echo &quot;.&quot;
}

stop()
{
       echo -e &quot;Stopping $DESC: $PROGNAME\n&quot;
       haproxy_pid=&quot;$(cat $PIDFILE)&quot;
       kill $haproxy_pid
       echo &quot;.&quot;
}

restart()
{
       echo -e &quot;Restarting $DESC: $PROGNAME\n&quot;
       $DAEMON -f $CONFIG -p $PIDFILE -sf $(cat $PIDFILE)
       echo &quot;.&quot;
}

case &quot;$1&quot; in
 start)
       start
       ;;
 stop)
       stop
       ;;
 restart)
       restart
       ;;
 *)
       echo &quot;Usage: $SCRIPTNAME {start|stop|restart}&quot; &gt;&amp;2
       exit 1
       ;;
esac

exit 0
</code></pre>

<p>运行</p>

<p>启动、停止和重启：</p>

<p>service haproxy start<br />
service haproxy stop<br />
service haproxy restart</p>

<p>添加日志</p>

<p>HAProxy 不会直接输出文件日志，所以我们要借助 Linux 的 rsyslog 来让 HAProxy 输出日志</p>

<pre><code>修改 haproxy.cfg
</code></pre>

<p>在 global 域和 defaults 域中添加：</p>

<p>global</p>

<pre><code>...
log 127.0.0.1 local0 info
log 127.0.0.1 local1 warning
...
</code></pre>

<p>defaults</p>

<pre><code>...
log global
...
</code></pre>

<p>意思是将 info 级（及以上）的日志推送到 rsyslog 的 local0 接口，将 warn 级（及以上）的日志推送到 rsyslog 的 local1 接口，并且所有 frontend 都默认使用 global 中的日志配置。</p>

<p>注：info 级的日志会打印 HAProxy 处理的每一条请求，会占用很大的磁盘空间，在生产环境中，建议将日志级别调整为 notice</p>

<pre><code>为 rsyslog 添加 haproxy 日志的配置
</code></pre>

<p>vi /etc/rsyslog.d/haproxy.conf</p>

<p>$ModLoad imudp<br />
$UDPServerRun 514<br />
$FileCreateMode 0644  #日志文件的权限<br />
$FileOwner ha  #日志文件的 owner<br />
local0.*     /var/log/haproxy.log  #local0 接口对应的日志输出文件<br />
local1.*     /var/log/haproxy_warn.log  #local1 接口对应的日志输出文件</p>

<pre><code>修改 rsyslog 的启动参数
</code></pre>

<p>vi /etc/sysconfig/rsyslog</p>

<h1 id="options-for-rsyslogd">Options for rsyslogd</h1>

<h1 id="syslogd-options-are-deprecated-since-rsyslog-v3">Syslogd options are deprecated since rsyslog v3.</h1>

<h1 id="if-you-want-to-use-them-switch-to-compatibility-mode-2-by-c-2">If you want to use them, switch to compatibility mode 2 by &ldquo;-c 2&rdquo;</h1>

<h1 id="see-rsyslogd-8-for-more-details">See rsyslogd(8) for more details</h1>

<p>SYSLOGD_OPTIONS=&ldquo;-c 2 -r -m 0&rdquo;</p>

<pre><code>重启 rsyslog 和 HAProxy
</code></pre>

<p>service rsyslog restart<br />
service haproxy restart</p>

<p>此时就应该能在 / var/log 目录下看到 haproxy 的日志文件了</p>

<pre><code>用 logrotate 进行日志切分
</code></pre>

<p>通过 rsyslog 输出的日志是不会进行切分的，所以需要依靠 Linux 提供的 logrotate 来进行切分工作</p>

<p>使用 root 用户，创建 haproxy 日志切分配置文件：</p>

<p>mkdir /root/logrotate<br />
vi /root/logrotate/haproxy</p>

<p>/var/log/haproxy.log /var/log/haproxy_warn.log {  #切分的两个文件名</p>

<pre><code>daily        #按天切分
rotate 7     #保留 7 份
create 0644 ha ha  #创建新文件的权限、用户、用户组
compress     #压缩旧日志
delaycompress  #延迟一天压缩
missingok    #忽略文件不存在的错误
dateext      #旧日志加上日志后缀
sharedscripts  #切分后的重启脚本只运行一次
postrotate   #切分后运行脚本重载 rsyslog，让 rsyslog 向新的日志文件中输出日志
  /bin/kill -HUP $(/bin/cat /var/run/syslogd.pid 2&gt;/dev/null) &amp;&gt;/dev/null
endscript
</code></pre>

<p>}</p>

<p>并配置在 crontab 中运行：</p>

<p>0 0 * * * /usr/sbin/logrotate /root/logrotate/haproxy</p>

<p>使用 HAProxy 搭建 L7 负载均衡器<br />
总体方案</p>

<p>本节中，我们将使用 HAProxy 搭建一个 L7 负载均衡器，应用如下功能</p>

<pre><code>负载均衡
会话保持
健康检查
根据 URI 前缀向不同的后端集群转发
监控页面
</code></pre>

<p>架构如下：<br />
1.png</p>

<p>架构中共有 6 个后端服务，划分为 3 组，每组中 2 个服务：</p>

<pre><code>ms1：服务 URI 前缀为 ms1 / 的请求
ms2：服务 URI 前缀为 ms2 / 的请求
def：服务其他请求
</code></pre>

<p>搭建</p>

<pre><code>搭建后端服务
</code></pre>

<p>部署 6 个后端服务，可以使用任意的 Web 服务，如 Nginx、Apache HTTPD、Tomcat、Jetty 等，具体 Web 服务的安装过程省略。</p>

<p>此例中，我们在 192.168.8.111 和 192.168.8.112 两台主机上分别安装了 3 个 Nginx：</p>

<pre><code>ms1.srv1 - 192.168.8.111:8080
ms1.srv2 - 192.168.8.112:8080
ms2.srv1 - 192.168.8.111:8081
ms2.srv2 - 192.168.8.112:8081
def.srv1 - 192.168.8.111:8082
def.srv2 - 192.168.8.112:8082
</code></pre>

<p>在这 6 个 Nginx 服务分别部署健康检查页面 healthCheck.html，页面内容任意。确保通过 <a href="http://ip:port/healthCheck.html" target="_blank">http://ip:port/healthCheck.html</a> 可以访问到这个页面</p>

<p>接下来在 6 个 Nginx 服务中部署服务页面：</p>

<pre><code>在第一组中部署 ms1/demo.html
在第二组中部署 ms2/demo.html
在第三组中部署 def/demo.html
</code></pre>

<p>demo.html 的内容，以部署在 192.168.8.111:8080 上的为例：</p>

<pre><code>Hello! This is ms1.srv1!
</code></pre>

<p>部署在 192.168.8.112:8080 上的就应该是</p>

<pre><code>Hello! This is ms1.srv2!
</code></pre>

<p>以此类推</p>

<pre><code>搭建 HAProxy
</code></pre>

<p>在 192.168.8.110 主机安装 HAProxy<br />
HAProxy 的安装和配置步骤如上一章中描述，此处略去</p>

<p>HAProxy 配置文件：</p>

<p>global</p>

<pre><code>daemon
maxconn 30000   #ulimit -n 至少为 60018
user ha
pidfile /home/ha/haproxy/conf/haproxy.pid
log 127.0.0.1 local0 info
log 127.0.0.1 local1 warning
</code></pre>

<p>defaults</p>

<pre><code>mode http
log global
option http-keep-alive   #使用 keepAlive 连接
option forwardfor        #记录客户端 IP 在 X-Forwarded-For 头域中
option httplog           #开启 httplog，HAProxy 会记录更丰富的请求信息
timeout connect 5000ms
timeout client 10000ms
timeout server 50000ms
timeout http-request 20000ms    #从连接创建开始到从客户端读取完整 HTTP 请求的超时时间，用于避免类 DoS 攻击
option httpchk GET /healthCheck.html    #定义默认的健康检查策略
</code></pre>

<p>frontend http-in</p>

<pre><code>bind *:9001
maxconn 30000                    #定义此端口上的 maxconn
acl url_ms1 path_beg -i /ms1/    #定义 ACL，当 uri 以 / ms1 / 开头时，ACL[url_ms1] 为 true
acl url_ms2 path_beg -i /ms2/    #同上，url_ms2
use_backend ms1 if url_ms1       #当 [url_ms1] 为 true 时，定向到后端服务群 ms1 中
use_backend ms2 if url_ms2       #当 [url_ms2] 为 true 时，定向到后端服务群 ms2 中
default_backend default_servers  #其他情况时，定向到后端服务群 default_servers 中
</code></pre>

<p>backend ms1    #定义后端服务群 ms1</p>

<pre><code>balance roundrobin    #使用 RR 负载均衡算法
cookie HA_STICKY_ms1 insert indirect nocache    #会话保持策略，insert 名为 &quot;HA_STICKY_ms1&quot; 的 cookie
#定义后端 server[ms1.srv1]，请求定向到该 server 时会在响应中写入 cookie 值 [ms1.srv1]
#针对此 server 的 maxconn 设置为 300
#应用默认健康检查策略，健康检查间隔和超时时间为 2000ms，两次成功视为节点 UP，三次失败视为节点 DOWN
server ms1.srv1 192.168.8.111:8080 cookie ms1.srv1 maxconn 300 check inter 2000ms rise 2 fall 3
#同上，inter 2000ms rise 2 fall 3 是默认值，可以省略
server ms1.srv2 192.168.8.112:8080 cookie ms1.srv2 maxconn 300 check
</code></pre>

<p>backend ms2    #定义后端服务群 ms2</p>

<pre><code>balance roundrobin
cookie HA_STICKY_ms2 insert indirect nocache
server ms2.srv1 192.168.8.111:8081 cookie ms2.srv1 maxconn 300 check
server ms2.srv2 192.168.8.112:8081 cookie ms2.srv2 maxconn 300 check
</code></pre>

<p>backend default_servers    #定义后端服务群 default_servers</p>

<pre><code>balance roundrobin
cookie HA_STICKY_def insert indirect nocache
server def.srv1 192.168.8.111:8082 cookie def.srv1 maxconn 300 check
server def.srv2 192.168.8.112:8082 cookie def.srv2 maxconn 300 check
</code></pre>

<p>listen stats    #定义监控页面</p>

<pre><code>bind *:1080                   #绑定端口 1080
stats refresh 30s             #每 30 秒更新监控数据
stats uri /stats              #访问监控页面的 uri
stats realm HAProxy\ Stats    #监控页面的认证提示
stats auth admin:admin        #监控页面的用户名和密码
</code></pre>

<p>修改完成后，启动 HAProxy</p>

<p>service haproxy start</p>

<p>测试</p>

<p>首先，访问一下监控页面 <a href="http://192.168.8.110:1080/stats" target="_blank">http://192.168.8.110:1080/stats</a> 并按提示输入用户名密码</p>

<p>接下来就能看到监控页面：<br />
2.png</p>

<p>监控页面中列出了我们配置的所有 frontend 和 backend 服务，以及它们的详细指标。如连接数，队列情况，session rate，流量，后端服务的健康状态等等</p>

<p>接下来，我们一一测试在 HAProxy 中配置的功能</p>

<pre><code>健康检查
</code></pre>

<p>从监控页面中就可以直接看出健康检查配置的是否正确，上图中可以看到，backend ms1、ms2、default_servers 下属的 6 个后端服务的 Status 都是 20h28m UP，代表健康状态已持续了 20 小时 28 分钟，而 LastChk 显示 L7OK/200 in 1ms 则代表在 1ms 前进行了 L7 的健康检查（即 HTTP 请求方式的健康检查），返回码为 200</p>

<p>此时我们将 ms1.srv1 中的 healthCheck.html 改名</p>

<p>mv healthCheck.html healthCheck.html.bak</p>

<p>然后再去看监控页面：<br />
3.png</p>

<p>ms1.srv1 的状态变成了 2s DOWN，LastChk 则是 L7STS/404 in 2ms，代表上次健康检查返回了 404<br />
再恢复 healthCheck.html，很快就能看到 ms1.srv1 重新恢复到 UP 状态</p>

<pre><code>通过 URI 前缀转发请求
</code></pre>

<p>访问 <a href="http://192.168.8.110:9001/ms1/demo.html" target="_blank">http://192.168.8.110:9001/ms1/demo.html</a> ：<br />
4.png</p>

<p>可以看到成功定向到了 ms1.srv1 上</p>

<p>访问 <a href="http://192.168.8.110:9001/ms2/demo.html" target="_blank">http://192.168.8.110:9001/ms2/demo.html</a> :<br />
5.png</p>

<p>访问 <a href="http://192.168.8.110:9001/def/demo.html" target="_blank">http://192.168.8.110:9001/def/demo.html</a> :<br />
6.png</p>

<p>3） 负载均衡和会话保持策略</p>

<p>在分别访问过 ms1/demo.html, ms2/demo.html, m3/demo.html 后，查看一下浏览器的 Cookie：</p>

<p>7.png</p>

<p>可以看到 HAProxy 已经回写了三个用于会话保持的 cookie，此时反复刷新这三个页面，会发现总是被定向到 *.srv1 上</p>

<p>接下来我们删除 HA_STICKY_ms1 这条 cookie，然后再访问 ms1/demo.html，会看到：<br />
8.png</p>

<p>同时也被新写入了一条 Cookie：<br />
9.png</p>

<p>如果发现仍然被定位到 ms1.srv1，同时也没有写入新的 HA_STICKY_ms1 Cookie，那么可能是浏览器缓存了 ms1/demo.html 页面，请求并没有到达 HAProxy。F5 刷新一下应该就可以了。<br />
使用 HAProxy 搭建 L4 负载均衡器</p>

<p>HAProxy 作为 L4 负载均衡器工作时，不会去解析任何与 HTTP 协议相关的内容，只在传输层对数据包进行处理。也就是说，以 L4 模式运行的 HAProxy，无法实现根据 URL 向不同后端转发、通过 cookie 实现会话保持等功能。</p>

<p>同时，在 L4 模式下工作的 HAProxy 也无法提供监控页面。</p>

<p>但作为 L4 负载均衡器的 HAProxy 能够提供更高的性能，适合于基于套接字的服务（如数据库、消息队列、RPC、邮件服务、Redis 等），或不需要逻辑规则判断，并已实现了会话共享的 HTTP 服务。<br />
总体方案</p>

<p>本例中，我们使用 HAProxy 以 L4 方式来代理两个 HTTP 服务，不提供会话保持。</p>

<p>global</p>

<pre><code>daemon
maxconn 30000   #ulimit -n 至少为 60018
user ha
pidfile /home/ha/haproxy/conf/haproxy.pid
log 127.0.0.1 local0 info
log 127.0.0.1 local1 warning
</code></pre>

<p>defaults</p>

<pre><code>mode tcp
log global
option tcplog            #开启 tcplog
timeout connect 5000ms
timeout client 10000ms
timeout server 10000ms   #TCP 模式下，应将 timeout client 和 timeout server 设置为一样的值，以防止出现问题
option httpchk GET /healthCheck.html    #定义默认的健康检查策略
</code></pre>

<p>frontend http-in</p>

<pre><code>bind *:9002
maxconn 30000                    #定义此端口上的 maxconn
default_backend default_servers  #请求定向至后端服务群 default_servers
</code></pre>

<p>backend default_servers    #定义后端服务群 default_servers</p>

<pre><code>balance roundrobin
server def.srv1 192.168.8.111:8082 maxconn 300 check
server def.srv2 192.168.8.112:8082 maxconn 300 check
</code></pre>

<p>L4 模式下的会话保持</p>

<p>虽然 TCP 模式下的 HAProxy 无法通过 HTTP Cookie 实现会话保持，但可以很方便的实现基于客户端 IP 的会话保持。只需将</p>

<pre><code>balance roundrobin
</code></pre>

<p>改为</p>

<pre><code>balance source
</code></pre>

<p>此外，HAProxy 提供了强大的 stick-table 功能，HAProxy 可以从传输层的数据包中采样出大量的属性，并将这些属性作为会话保持的策略写入 stick-table 中。<br />
本文中不对 stick-table 进行深入探讨，如需要了解，可参考官方文档 configuration.html#4-stick-table<br />
HAProxy 关键配置详解<br />
总览</p>

<p>HAProxy 的配置文件共有 5 个域</p>

<pre><code>global：用于配置全局参数
default：用于配置所有 frontend 和 backend 的默认属性
frontend：用于配置前端服务（即 HAProxy 自身提供的服务）实例
backend：用于配置后端服务（即 HAProxy 后面接的服务）实例组
listen：frontend+backend 的组合配置，可以理解成更简洁的配置方法
</code></pre>

<p>global 域的关键配置</p>

<pre><code>daemon：指定 HAProxy 以后台模式运行，通常情况下都应该使用这一配置
user [username] ：指定 HAProxy 进程所属的用户
group [groupname] ：指定 HAProxy 进程所属的用户组
log [address] [device] [maxlevel] [minlevel]：日志输出配置，如 log 127.0.0.1 local0 info warning，即向本机 rsyslog 或 syslog 的 local0 输出 info 到 warning 级别的日志。其中 [minlevel] 可以省略。HAProxy 的日志共有 8 个级别，从高到低为 emerg/alert/crit/err/warning/notice/info/debug
pidfile ：指定记录 HAProxy 进程号的文件绝对路径。主要用于 HAProxy 进程的停止和重启动作。
maxconn ：HAProxy 进程同时处理的连接数，当连接数达到这一数值时，HAProxy 将停止接收连接请求
</code></pre>

<p>frontend 域的关键配置</p>

<pre><code>acl [name] [criterion] [flags] [operator] [value]：定义一条 ACL，ACL 是根据数据包的指定属性以指定表达式计算出的 true/false 值。如 &quot;acl url_ms1 path_beg -i /ms1/&quot; 定义了名为 url_ms1 的 ACL，该 ACL 在请求 uri 以 / ms1 / 开头（忽略大小写）时为 true
bind [ip]:[port]：frontend 服务监听的端口
default_backend [name]：frontend 对应的默认 backend
disabled：禁用此 frontend
http-request [operation] [condition]：对所有到达此 frontend 的 HTTP 请求应用的策略，例如可以拒绝、要求认证、添加 header、替换 header、定义 ACL 等等。
http-response [operation] [condition]：对所有从此 frontend 返回的 HTTP 响应应用的策略，大体同上
log：同 global 域的 log 配置，仅应用于此 frontend。如果要沿用 global 域的 log 配置，则此处配置为 log global
maxconn：同 global 域的 maxconn，仅应用于此 frontend
mode：此 frontend 的工作模式，主要有 http 和 tcp 两种，对应 L7 和 L4 两种负载均衡模式
option forwardfor：在请求中添加 X-Forwarded-For Header，记录客户端 ip
option http-keep-alive：以 KeepAlive 模式提供服务
option httpclose：与 http-keep-alive 对应，关闭 KeepAlive 模式，如果 HAProxy 主要提供的是接口类型的服务，可以考虑采用 httpclose 模式，以节省连接数资源。但如果这样做了，接口的调用端将不能使用 HTTP 连接池
option httplog：开启 httplog，HAProxy 将会以类似 Apache HTTP 或 Nginx 的格式来记录请求日志
option tcplog：开启 tcplog，HAProxy 将会在日志中记录数据包在传输层的更多属性
stats uri [uri]：在此 frontend 上开启监控页面，通过 [uri] 访问
stats refresh [time]：监控数据刷新周期
stats auth [user]:[password]：监控页面的认证用户名密码
timeout client [time]：指连接创建后，客户端持续不发送数据的超时时间
timeout http-request [time]：指连接创建后，客户端没能发送完整 HTTP 请求的超时时间，主要用于防止 DoS 类攻击，即创建连接后，以非常缓慢的速度发送请求包，导致 HAProxy 连接被长时间占用
use_backend [backend] if|unless [acl]：与 ACL 搭配使用，在满足 / 不满足 ACL 时转发至指定的 backend
</code></pre>

<p>backend 域的关键配置</p>

<pre><code>acl：同 frontend 域
balance [algorithm]：在此 backend 下所有 server 间的负载均衡算法，常用的有 roundrobin 和 source，完整的算法说明见官方文档 configuration.html#4.2-balance
cookie：在 backend server 间启用基于 cookie 的会话保持策略，最常用的是 insert 方式，如 cookie HA_STICKY_ms1 insert indirect nocache，指 HAProxy 将在响应中插入名为 HA_STICKY_ms1 的 cookie，其值为对应的 server 定义中指定的值，并根据请求中此 cookie 的值决定转发至哪个 server。indirect 代表如果请求中已经带有合法的 HA_STICK_ms1 cookie，则 HAProxy 不会在响应中再次插入此 cookie，nocache 则代表禁止链路上的所有网关和缓存服务器缓存带有 Set-Cookie 头的响应。
default-server：用于指定此 backend 下所有 server 的默认设置。具体见下面的 server 配置。
disabled：禁用此 backend
http-request/http-response：同 frontend 域
log：同 frontend 域
mode：同 frontend 域
option forwardfor：同 frontend 域
option http-keep-alive：同 frontend 域
option httpclose：同 frontend 域
option httpchk [METHOD] [URL] [VERSION]：定义以 http 方式进行的健康检查策略。如 option httpchk GET /healthCheck.html HTTP/1.1
option httplog：同 frontend 域
option tcplog：同 frontend 域
server [name] [ip]:[port] [params]：定义 backend 中的一个后端 server，[params] 用于指定这个 server 的参数，常用的包括有：

check：指定此参数时，HAProxy 将会对此 server 执行健康检查，检查方法在 option httpchk 中配置。同时还可以在 check 后指定 inter, rise, fall 三个参数，分别代表健康检查的周期、连续几次成功认为 server UP，连续几次失败认为 server DOWN，默认值是 inter 2000ms rise 2 fall 3
cookie [value]：用于配合基于 cookie 的会话保持，如 cookie ms1.srv1 代表交由此 server 处理的请求会在响应中写入值为 ms1.srv1 的 cookie（具体的 cookie 名则在 backend 域中的 cookie 设置中指定）
maxconn：指 HAProxy 最多同时向此 server 发起的连接数，当连接数到达 maxconn 后，向此 server 发起的新连接会进入等待队列。默认为 0，即无限
maxqueue：等待队列的长度，当队列已满后，后续请求将会发至此 backend 下的其他 server，默认为 0，即无限
weight：server 的权重，0-256，权重越大，分给这个 server 的请求就越多。weight 为 0 的 server 将不会被分配任何新的连接。所有 server 默认 weight 为 1

timeout connect [time]：指 HAProxy 尝试与 backend server 创建连接的超时时间
timeout check [time]：默认情况下，健康检查的连接 + 响应超时时间为 server 命令中指定的 inter 值，如果配置了 timeout check，HAProxy 会以 inter 作为健康检查请求的连接超时时间，并以 timeout check 的值作为健康检查请求的响应超时时间
timeout server [time]：指 backend server 响应 HAProxy 请求的超时时间
</code></pre>

<p>default 域</p>

<p>上文所属的 frontend 和 backend 域关键配置中，除 acl、bind、http-request、http-response、use_backend 外，其余的均可以配置在 default 域中。default 域中配置了的项目，如果在 frontend 或 backend 域中没有配置，将会使用 default 域中的配置。<br />
listen 域</p>

<p>listen 域是 frontend 域和 backend 域的组合，frontend 域和 backend 域中所有的配置都可以配置在 listen 域下<br />
官方配置文档</p>

<p>HAProxy 的配置项非常多，支持非常丰富的功能，上文只列出了作为 L7 负载均衡器使用 HAProxy 时的一些关键参数。完整的参数说明请参见官方文档 configuration.html<br />
使用 Keepalived 实现 HAProxy 高可用</p>

<p>尽管 HAProxy 非常稳定，但仍然无法规避操作系统故障、主机硬件故障、网络故障甚至断电带来的风险。所以必须对 HAProxy 实施高可用方案。</p>

<p>下文将介绍利用 Keepalived 实现的 HAProxy 热备方案。即两台主机上的两个 HAProxy 实例同时在线，其中权重较高的实例为 MASTER，MASTER 出现问题时，另一台实例自动接管所有流量。<br />
原理</p>

<p>在两台 HAProxy 的主机上分别运行着一个 Keepalived 实例，这两个 Keepalived 争抢同一个虚 IP 地址，两个 HAProxy 也尝试去绑定这同一个虚 IP 地址上的端口。<br />
显然，同时只能有一个 Keepalived 抢到这个虚 IP，抢到了这个虚 IP 的 Keepalived 主机上的 HAProxy 便是当前的 MASTER。<br />
Keepalived 内部维护一个权重值，权重值最高的 Keepalived 实例能够抢到虚 IP。同时 Keepalived 会定期 check 本主机上的 HAProxy 状态，状态 OK 时权重值增加。<br />
搭建 HAProxy 主备集群</p>

<pre><code>环境准备
</code></pre>

<p>在两台物理机上安装并配置 HAProxy，本例中，将在 192.168.8.110 和 192.168.8.111 两台主机上上安装两套完全一样的 HAProxy，具体步骤省略，请参考 “使用 HAProxy 搭建 L7 负载均衡器” 一节。</p>

<pre><code>安装 Keepalived
</code></pre>

<p>下载，解压，编译，安装：</p>

<p>wget <a href="http://www.keepalived.org/software/keepalived-1.2.19.tar.gz" target="_blank">http://www.keepalived.org/software/keepalived-1.2.19.tar.gz</a><br />
tar -xzf keepalived-1.2.19.tar.gz<br />
./configure &ndash;prefix=/usr/local/keepalived<br />
make<br />
make install</p>

<p>注册为系统服务：</p>

<p>cp /usr/local/keepalived/sbin/keepalived /usr/sbin/<br />
cp /usr/local/keepalived/etc/sysconfig/keepalived /etc/sysconfig/<br />
cp /usr/local/keepalived/etc/rc.d/init.d/keepalived /etc/init.d/<br />
chmod +x /etc/init.d/keepalived</p>

<p>注意：Keepalived 需要使用 root 用户进行安装和配置</p>

<pre><code>配置 Keepalived
</code></pre>

<p>创建并编辑配置文件</p>

<p>mkdir -p /etc/keepalived/<br />
cp /usr/local/keepalived/etc/keepalived/keepalived.conf /etc/keepalived/<br />
vi /etc/keepalived/keepalived.conf</p>

<p>配置文件内容：</p>

<p>global_defs {</p>

<pre><code>router_id LVS_DEVEL  #虚拟路由名称
</code></pre>

<p>}</p>

<p>#HAProxy 健康检查配置<br />
vrrp_script chk_haproxy {</p>

<pre><code>script &quot;killall -0 haproxy&quot;  #使用 killall -0 检查 haproxy 实例是否存在，性能高于 ps 命令
interval 2   #脚本运行周期
weight 2   #每次检查的加权权重值
</code></pre>

<p>}</p>

<h1 id="虚拟路由配置">虚拟路由配置</h1>

<p>vrrp_instance VI_1 {</p>

<pre><code>state MASTER           #本机实例状态，MASTER/BACKUP，备机配置文件中请写 BACKUP
interface enp0s25      #本机网卡名称，使用 ifconfig 命令查看
virtual_router_id 51   #虚拟路由编号，主备机保持一致
priority 101           #本机初始权重，备机请填写小于主机的值（例如 100）
advert_int 1           #争抢虚地址的周期，秒
virtual_ipaddress {
    192.168.8.201      #虚地址 IP，主备机保持一致
}
track_script {
    chk_haproxy        #对应的健康检查配置
}
</code></pre>

<p>}</p>

<p>如果主机没有 killall 命令，则需要安装 psmisc 包：</p>

<p>yum intall psmisc</p>

<pre><code>分别启动两个 Keepalived
</code></pre>

<p>service keepalived start</p>

<p>验证</p>

<p>启动后，先分别在两台主机查看虚 IP 192.168.8.201 由谁持有，执行命令：</p>

<p>ip addr sh enp0s25   （将 enp0s25 替换成主机的网卡名）</p>

<p>持有虚 IP 的主机输出会是这样的：<br />
10.png</p>

<p>另一台主机输出则是这样的：<br />
11.png</p>

<p>如果你先启动备机的 Keepalived，那么很有可能虚 IP 会被备机抢到，因为备机的权重配置只比主机低 1，只要执行一次健康检查就能把权重提高到 102，高于主机的 101。</p>

<p>此时访问 <a href="http://192.168.8.201:9001/ms1/demo.html" target="_blank">http://192.168.8.201:9001/ms1/demo.html</a> ，可以看到我们先前部署的网页。</p>

<p>此时，检查 / var/log/haproxy.log，能看到此请求落在了抢到了虚 IP 的主机上。</p>

<p>接下来，我们停掉当前 MASTER 主机的 HAProxy 实例（或者 Keepalive 实例，效果一样）</p>

<p>service haproxy stop</p>

<p>再次访问 <a href="http://192.168.8.201:9001/ms1/demo.html" target="_blank">http://192.168.8.201:9001/ms1/demo.html</a> ，并查看备机的 / var/log/haproxy.log，会看到此请求落在了备机上，主备自动切换成功。</p>

<p>也可以再次执行 ip addr sh enp0s25 命令，会看到虚 IP 被备机抢去了。</p>

<p>在 / var/log/message 中，也能够看到 keepalived 输出的切换日志：<br />
12.png</p>

<p>作者：kelgon<br />
链接：<a href="https://www.jianshu.com/p/c9f6d55288c0" target="_blank">https://www.jianshu.com/p/c9f6d55288c0</a><br />
來源：简书<br />
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>

                      
                    </div>
                    
                    <div class="clear"></div>
                  </div>
                  

                </div>
                
              </article>
              
              <div class="clear"></div>
              

              
<section id="comments" class="themeform">
  <div id="SOHUCS"></div>
	<script type="text/javascript">
	(function(){
		if (window.location.hostname === 'localhost') return;
		if (window.location.hostname === '127.0.0.1') return;

		var appid = 'cytgPrsTW';
		var conf = 'prod_a8b514a0c64b034bba38e466be98c266';
		var width = window.innerWidth || document.documentElement.clientWidth;
		if (width < 960) {window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>'); } else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})}); }
	})();
	</script>

  

  



  


</section>

            </div>
          </section>
          <div class="sidebar s1">
  <a class="sidebar-toggle" title="Expand Sidebar"><i class="fa icon-sidebar-toggle"></i></a>
  <div class="sidebar-content">
    <div class="sidebar-top group">
      <p>Follow:</p>
      <ul class="social-links">
    <li>
    <a class="social-tooltip" title="On WeiBo" rel="nofollow"
        href="http://weibo.com/rinetd" target="_blank">
        <i class="fa fa-weibo"></i>
    </a>
    </li>
    <li>
    <a class="social-tooltip" title="On Twitter" rel="nofollow"
        href="https://twitter.com/rinetd" target="_blank">
        <i class="fa fa-twitter"></i>
    </a>
    </li>
    <li>
    <a class="social-tooltip" title="On GitHub" rel="nofollow"
        href="https://github.com/rinetd" target="_blank">
        <i class="fa fa-github"></i>
    </a>
    </li>
</ul>

    </div>

    <ul class="post-nav group">
    <li class="previous">
      
      <a href="http://blog.pytool.com/linux/haproxy/haproxy-syslog/" rel="prev">
        <i class="fa fa-chevron-left"></i>
        <strong>Previous Post</strong>
        <span>Haproxy Syslog</span>
      </a>
      
  </li>
</ul>

    <div id="categories-2" class="widget widget_categories"><h3>分类</h3>
  <ul>
    
      <li class="cat-item cat-item-1">
        <a rel="nofollow" href="../../../categories/android/">Android</a>
        <small>(17)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a rel="nofollow" href="../../../categories/devops/">Devops</a>
        <small>(61)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a rel="nofollow" href="../../../categories/docker/">Docker</a>
        <small>(15)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a rel="nofollow" href="../../../categories/golang/">Golang</a>
        <small>(68)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a rel="nofollow" href="../../../categories/linux/">Linux</a>
        <small>(77)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a rel="nofollow" href="../../../categories/linux-%E5%91%BD%E4%BB%A4/">Linux-命令</a>
        <small>(107)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a rel="nofollow" href="../../../categories/windows/">Windows</a>
        <small>(5)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a rel="nofollow" href="../../../categories/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/">前端技术</a>
        <small>(3)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a rel="nofollow" href="../../../categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/">嵌入式</a>
        <small>(22)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a rel="nofollow" href="../../../categories/%E5%B8%B8%E7%94%A8%E7%AE%97%E6%B3%95/">常用算法</a>
        <small>(2)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a rel="nofollow" href="../../../categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
        <small>(29)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a rel="nofollow" href="../../../categories/%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91/">文本编辑</a>
        <small>(27)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a rel="nofollow" href="../../../categories/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/">正则表达式</a>
        <small>(3)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a rel="nofollow" href="../../../categories/%E7%94%9F%E6%B4%BB%E6%8A%80%E5%B7%A7/">生活技巧</a>
        <small>(4)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a rel="nofollow" href="../../../categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/">网络安全</a>
        <small>(39)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a rel="nofollow" href="../../../categories/%E9%9B%86%E7%BE%A4%E7%9B%91%E6%8E%A7/">集群监控</a>
        <small>(6)</small>
      </li>
    
      <li class="cat-item cat-item-1">
        <a rel="nofollow" href="../../../categories/%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2/">静态博客</a>
        <small>(12)</small>
      </li>
    
  </ul>

</div>


    
    
     
  
  </div>
  
</div>

          <div class="sidebar s2">
  <a rel="nofollow" class="sidebar-toggle" title="Expand Sidebar"><i class="fa icon-sidebar-toggle"></i></a>
  <div class="sidebar-content">
    <div class="sidebar-top group">
      <p>More</p>
    </div>

    
   
    <ul class="post-nav group">
    <li class="next">
      
      <a href="http://blog.pytool.com/linux/haproxy/haproxy-config/" rel="next">
        <i class="fa fa-chevron-right"></i>
        <strong>Next post</strong>
        <span>HAproxy指南之haproxy配置详解</span>
      </a>
      
  </li>
</ul>

    <div id="tag_cloud-2" class="widget widget_tag_cloud"><h3>标签云</h3>
  <div class="tagcloud post-tags">

      
        
          <a rel="nofollow" rel="tag" href="../../../tags/ack/" class="tag-link-1" title="1 Posts">ack<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/activity/" class="tag-link-1" title="1 Posts">activity<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/adb/" class="tag-link-1" title="1 Posts">adb<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/android/" class="tag-link-1" title="1 Posts">android<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/ansible/" class="tag-link-12" title="1 Posts">ansible<small>(12)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/aria2/" class="tag-link-1" title="1 Posts">aria2<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/arp/" class="tag-link-1" title="1 Posts">arp<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/atom/" class="tag-link-1" title="1 Posts">atom<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/autohotkey/" class="tag-link-1" title="1 Posts">autohotkey<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/awesome/" class="tag-link-2" title="1 Posts">awesome<small>(2)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/awk/" class="tag-link-1" title="1 Posts">awk<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/bash/" class="tag-link-1" title="1 Posts">bash<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/bc/" class="tag-link-1" title="1 Posts">bc<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/bower/" class="tag-link-1" title="1 Posts">bower<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/brew/" class="tag-link-1" title="1 Posts">brew<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/bubble/" class="tag-link-1" title="1 Posts">bubble<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/burpssuite/" class="tag-link-1" title="1 Posts">burpssuite<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/burpsuite/" class="tag-link-1" title="1 Posts">burpsuite<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/can/" class="tag-link-1" title="1 Posts">can<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/capistrano/" class="tag-link-1" title="1 Posts">capistrano<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/cash/" class="tag-link-1" title="1 Posts">cash<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/centos7/" class="tag-link-2" title="1 Posts">centos7<small>(2)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/coffeescript/" class="tag-link-1" title="1 Posts">coffeescript<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/composer/" class="tag-link-1" title="1 Posts">composer<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/crontab/" class="tag-link-1" title="1 Posts">crontab<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/cryptsetup/" class="tag-link-1" title="1 Posts">cryptsetup<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/css/" class="tag-link-11" title="1 Posts">css<small>(11)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/css3/" class="tag-link-1" title="1 Posts">css3<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/ctags/" class="tag-link-1" title="1 Posts">ctags<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/curd/" class="tag-link-3" title="1 Posts">curd<small>(3)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/curl/" class="tag-link-2" title="1 Posts">curl<small>(2)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/date/" class="tag-link-1" title="1 Posts">date<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/dd/" class="tag-link-1" title="1 Posts">dd<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/debug/" class="tag-link-1" title="1 Posts">debug<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/decode/" class="tag-link-1" title="1 Posts">decode<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/defer/" class="tag-link-1" title="1 Posts">defer<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/devops/" class="tag-link-1" title="1 Posts">devops<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/discourse/" class="tag-link-1" title="1 Posts">discourse<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/dnsmasq/" class="tag-link-1" title="1 Posts">dnsmasq<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/docker/" class="tag-link-17" title="1 Posts">docker<small>(17)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/dpkg/" class="tag-link-1" title="1 Posts">dpkg<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/drone/" class="tag-link-17" title="1 Posts">drone<small>(17)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/editorconfig/" class="tag-link-1" title="1 Posts">editorconfig<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/emacs/" class="tag-link-12" title="1 Posts">emacs<small>(12)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/enca/" class="tag-link-1" title="1 Posts">enca<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/encode/" class="tag-link-3" title="1 Posts">encode<small>(3)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/etcd/" class="tag-link-4" title="1 Posts">etcd<small>(4)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/expect/" class="tag-link-1" title="1 Posts">expect<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/expr/" class="tag-link-1" title="1 Posts">expr<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/extundelete/" class="tag-link-1" title="1 Posts">extundelete<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/ffmpeg/" class="tag-link-1" title="1 Posts">ffmpeg<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/find/" class="tag-link-1" title="1 Posts">find<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/firewall/" class="tag-link-1" title="1 Posts">firewall<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/flannel/" class="tag-link-1" title="1 Posts">flannel<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/fonts/" class="tag-link-1" title="1 Posts">fonts<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/free/" class="tag-link-1" title="1 Posts">free<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/fstab/" class="tag-link-1" title="1 Posts">fstab<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/gdb/" class="tag-link-1" title="1 Posts">gdb<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/git/" class="tag-link-1" title="1 Posts">git<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/go/" class="tag-link-1" title="1 Posts">go<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/go-shadowsocks2/" class="tag-link-1" title="1 Posts">go-shadowsocks2<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/golang/" class="tag-link-25" title="1 Posts">golang<small>(62)</small></a>
          
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/gpg/" class="tag-link-1" title="1 Posts">gpg<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/grep/" class="tag-link-1" title="1 Posts">grep<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/gui/" class="tag-link-1" title="1 Posts">gui<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/haproxy/" class="tag-link-5" title="1 Posts">haproxy<small>(5)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/hexdump/" class="tag-link-1" title="1 Posts">hexdump<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/hexo/" class="tag-link-2" title="1 Posts">hexo<small>(2)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/hmac/" class="tag-link-1" title="1 Posts">hmac<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/html/" class="tag-link-1" title="1 Posts">html<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/html5/" class="tag-link-1" title="1 Posts">html5<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/http/" class="tag-link-1" title="1 Posts">http<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/httperf/" class="tag-link-1" title="1 Posts">httperf<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/hugo/" class="tag-link-11" title="1 Posts">hugo<small>(11)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/hydra/" class="tag-link-1" title="1 Posts">hydra<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/i18n/" class="tag-link-1" title="1 Posts">i18n<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/ifttt/" class="tag-link-1" title="1 Posts">ifttt<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/imagemagick/" class="tag-link-2" title="1 Posts">imagemagick<small>(2)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/index/" class="tag-link-1" title="1 Posts">index<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/insomnia/" class="tag-link-1" title="1 Posts">insomnia<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/intent/" class="tag-link-1" title="1 Posts">intent<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/ios/" class="tag-link-1" title="1 Posts">ios<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/iotop/" class="tag-link-1" title="1 Posts">iotop<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/ip/" class="tag-link-2" title="1 Posts">ip<small>(2)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/iproute2/" class="tag-link-5" title="1 Posts">iproute2<small>(5)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/iptables/" class="tag-link-13" title="1 Posts">iptables<small>(13)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/irc/" class="tag-link-1" title="1 Posts">irc<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/javascript/" class="tag-link-6" title="1 Posts">javascript<small>(6)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/join/" class="tag-link-1" title="1 Posts">join<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/js/" class="tag-link-1" title="1 Posts">js<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/jwt/" class="tag-link-2" title="1 Posts">jwt<small>(2)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/k8s/" class="tag-link-1" title="1 Posts">k8s<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/key/" class="tag-link-1" title="1 Posts">key<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/kubernetes/" class="tag-link-10" title="1 Posts">kubernetes<small>(10)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/linux/" class="tag-link-6" title="1 Posts">linux<small>(6)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/linux%E5%91%BD%E4%BB%A4/" class="tag-link-1" title="1 Posts">linux命令<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/locale/" class="tag-link-1" title="1 Posts">locale<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/losetup/" class="tag-link-1" title="1 Posts">losetup<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/lsof/" class="tag-link-1" title="1 Posts">lsof<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/lunr/" class="tag-link-1" title="1 Posts">lunr<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/lvm2/" class="tag-link-1" title="1 Posts">lvm2<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/lvs/" class="tag-link-8" title="1 Posts">lvs<small>(8)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/makefile/" class="tag-link-2" title="1 Posts">makefile<small>(2)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/mariadb/" class="tag-link-8" title="1 Posts">mariadb<small>(8)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/mathjax/" class="tag-link-1" title="1 Posts">mathjax<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/mbr/" class="tag-link-1" title="1 Posts">mbr<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/md5/" class="tag-link-1" title="1 Posts">md5<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/md5sum/" class="tag-link-1" title="1 Posts">md5sum<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/meteor/" class="tag-link-7" title="1 Posts">meteor<small>(7)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/mongo/" class="tag-link-1" title="1 Posts">mongo<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/mongodb/" class="tag-link-2" title="1 Posts">mongodb<small>(2)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/mtr/" class="tag-link-1" title="1 Posts">mtr<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/mysql/" class="tag-link-25" title="1 Posts">mysql<small>(47)</small></a>
          
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/navicat64/" class="tag-link-1" title="1 Posts">navicat64<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/nessus/" class="tag-link-1" title="1 Posts">nessus<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/netcat/" class="tag-link-1" title="1 Posts">netcat<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/netsh/" class="tag-link-1" title="1 Posts">netsh<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/nexpose/" class="tag-link-1" title="1 Posts">nexpose<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/nginx/" class="tag-link-25" title="1 Posts">nginx<small>(26)</small></a>
          
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/nmap/" class="tag-link-3" title="1 Posts">nmap<small>(3)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/nodejs/" class="tag-link-1" title="1 Posts">nodejs<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/npm/" class="tag-link-2" title="1 Posts">npm<small>(2)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/ntp/" class="tag-link-1" title="1 Posts">ntp<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/oauth2/" class="tag-link-2" title="1 Posts">oauth2<small>(2)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/objdump/" class="tag-link-1" title="1 Posts">objdump<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/openid/" class="tag-link-1" title="1 Posts">openid<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/openssl/" class="tag-link-1" title="1 Posts">openssl<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/pandoc/" class="tag-link-2" title="1 Posts">pandoc<small>(2)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/pdf/" class="tag-link-1" title="1 Posts">pdf<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/perf/" class="tag-link-1" title="1 Posts">perf<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/php/" class="tag-link-3" title="1 Posts">php<small>(3)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/pip/" class="tag-link-1" title="1 Posts">pip<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/playbook/" class="tag-link-1" title="1 Posts">playbook<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/postgresql/" class="tag-link-1" title="1 Posts">postgresql<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/powershell/" class="tag-link-2" title="1 Posts">powershell<small>(2)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/prepare/" class="tag-link-1" title="1 Posts">prepare<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/prometheus/" class="tag-link-6" title="1 Posts">prometheus<small>(6)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/proxy/" class="tag-link-1" title="1 Posts">proxy<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/python/" class="tag-link-5" title="1 Posts">python<small>(5)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/redis/" class="tag-link-1" title="1 Posts">redis<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/rename/" class="tag-link-1" title="1 Posts">rename<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/repo/" class="tag-link-1" title="1 Posts">repo<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/resin/" class="tag-link-1" title="1 Posts">resin<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/responsive/" class="tag-link-1" title="1 Posts">responsive<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/restful/" class="tag-link-5" title="1 Posts">restful<small>(5)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/rethinkdb/" class="tag-link-1" title="1 Posts">rethinkdb<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/retina/" class="tag-link-1" title="1 Posts">retina<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/root/" class="tag-link-1" title="1 Posts">root<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/route/" class="tag-link-1" title="1 Posts">route<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/rsync/" class="tag-link-2" title="1 Posts">rsync<small>(2)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/rtsp/" class="tag-link-1" title="1 Posts">rtsp<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/ruby/" class="tag-link-1" title="1 Posts">ruby<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/samba/" class="tag-link-1" title="1 Posts">samba<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/sar/" class="tag-link-1" title="1 Posts">sar<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/scoop/" class="tag-link-1" title="1 Posts">scoop<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/scp/" class="tag-link-1" title="1 Posts">scp<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/scrapy/" class="tag-link-8" title="1 Posts">scrapy<small>(8)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/sed/" class="tag-link-3" title="1 Posts">sed<small>(3)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/selenium/" class="tag-link-1" title="1 Posts">selenium<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/seo/" class="tag-link-4" title="1 Posts">seo<small>(4)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/sftp/" class="tag-link-1" title="1 Posts">sftp<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/shell/" class="tag-link-6" title="1 Posts">shell<small>(6)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/signal/" class="tag-link-1" title="1 Posts">signal<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/snap/" class="tag-link-1" title="1 Posts">snap<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/sort/" class="tag-link-1" title="1 Posts">sort<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/ssh/" class="tag-link-3" title="1 Posts">ssh<small>(3)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/ssl/" class="tag-link-1" title="1 Posts">ssl<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/sso/" class="tag-link-1" title="1 Posts">sso<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/ssrf/" class="tag-link-1" title="1 Posts">ssrf<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/stm32/" class="tag-link-5" title="1 Posts">stm32<small>(5)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/strace/" class="tag-link-1" title="1 Posts">strace<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/sublime/" class="tag-link-1" title="1 Posts">sublime<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/sudo/" class="tag-link-1" title="1 Posts">sudo<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/svg/" class="tag-link-1" title="1 Posts">svg<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/swagger/" class="tag-link-1" title="1 Posts">swagger<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/swarm/" class="tag-link-2" title="1 Posts">swarm<small>(2)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/sysbench/" class="tag-link-2" title="1 Posts">sysbench<small>(2)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/sysctlcd/" class="tag-link-1" title="1 Posts">sysctlcd<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/syslog/" class="tag-link-1" title="1 Posts">syslog<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/systemctl/" class="tag-link-1" title="1 Posts">systemctl<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/taints/" class="tag-link-1" title="1 Posts">taints<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/tc/" class="tag-link-2" title="1 Posts">tc<small>(2)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/tcpdump/" class="tag-link-2" title="1 Posts">tcpdump<small>(2)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/telegraf/" class="tag-link-1" title="1 Posts">telegraf<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/time/" class="tag-link-1" title="1 Posts">time<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/timezone/" class="tag-link-2" title="1 Posts">timezone<small>(2)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/tmux/" class="tag-link-1" title="1 Posts">tmux<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/top/" class="tag-link-1" title="1 Posts">top<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/tr/" class="tag-link-1" title="1 Posts">tr<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/tshark/" class="tag-link-2" title="1 Posts">tshark<small>(2)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/ubuntu/" class="tag-link-2" title="1 Posts">ubuntu<small>(2)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/ulimit/" class="tag-link-1" title="1 Posts">ulimit<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/underscore/" class="tag-link-1" title="1 Posts">underscore<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/unpack/" class="tag-link-1" title="1 Posts">unpack<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/update-alternatives/" class="tag-link-1" title="1 Posts">update-alternatives<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/useradd/" class="tag-link-1" title="1 Posts">useradd<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/vim/" class="tag-link-11" title="1 Posts">vim<small>(11)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/visualstudiocode/" class="tag-link-1" title="1 Posts">visualstudiocode<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/vlc/" class="tag-link-1" title="1 Posts">vlc<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/webpack3/" class="tag-link-2" title="1 Posts">webpack3<small>(2)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/wget/" class="tag-link-1" title="1 Posts">wget<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/windows/" class="tag-link-2" title="1 Posts">windows<small>(2)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/windows10/" class="tag-link-1" title="1 Posts">windows10<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/windump/" class="tag-link-1" title="1 Posts">windump<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/wireshark/" class="tag-link-2" title="1 Posts">wireshark<small>(2)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/xargs/" class="tag-link-1" title="1 Posts">xargs<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/xidel/" class="tag-link-2" title="1 Posts">xidel<small>(2)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/xml/" class="tag-link-2" title="1 Posts">xml<small>(2)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/xmllint/" class="tag-link-1" title="1 Posts">xmllint<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/xpath/" class="tag-link-1" title="1 Posts">xpath<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/yaml/" class="tag-link-2" title="1 Posts">yaml<small>(2)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/zabbix/" class="tag-link-1" title="1 Posts">zabbix<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/%E5%93%8D%E5%BA%94%E5%BC%8F/" class="tag-link-1" title="1 Posts">响应式<small>(1)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" class="tag-link-2" title="1 Posts">微服务<small>(2)</small></a>
        
      
        
          <a rel="nofollow" rel="tag" href="../../../tags/%E8%B4%A6%E6%88%B7%E7%B3%BB%E7%BB%9F/" class="tag-link-1" title="1 Posts">账户系统<small>(1)</small></a>
        
      
  </div>
</div>

    

    
  </div>
</div>

        </div>
      </div>
    </div>
  </div>
</div>


<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-106129999-2', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>

    
    <noscript>
        <iframe src="//www.googletagmanager.com/ns.html?id=GTM-5HM5XM2" height="0" width="0"
                style="display:none;visibility:hidden"></iframe>
    </noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-5HM5XM2');
    </script>
    
<script id="baidu_analytics">
  var _hmt = _hmt || [];
  (function() {
    if (window.location.hostname === 'localhost') return;
    var hm = document.createElement("script"); hm.async = true;
    hm.src = "https://hm.baidu.com/hm.js?e2103759b6030b3c4ac84c63c542e493";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script>



<footer id="footer">
  <section class="container" id="footer-bottom">
    <div class="container-inner">
      <a id="back-to-top" href="#"><i class="fa fa-angle-up"></i></a>
      <div class="pad group">
        <div class="grid one-half">
          <div id="copyright">
              <p>Copyright (c) 2017. All rights reserved. (版权所有) <a href='http://www.miitbeian.gov.cn/'>鲁ICP备17074587号-1</a></p>
              
          </div>
          
        </div>
        
        <div class="grid one-half last">
          <ul class="social-links">
    <li>
    <a class="social-tooltip" title="On WeiBo" rel="nofollow"
        href="http://weibo.com/rinetd" target="_blank">
        <i class="fa fa-weibo"></i>
    </a>
    </li>
    <li>
    <a class="social-tooltip" title="On Twitter" rel="nofollow"
        href="https://twitter.com/rinetd" target="_blank">
        <i class="fa fa-twitter"></i>
    </a>
    </li>
    <li>
    <a class="social-tooltip" title="On GitHub" rel="nofollow"
        href="https://github.com/rinetd" target="_blank">
        <i class="fa fa-github"></i>
    </a>
    </li>
</ul>

        </div>
      </div>

    </div>
    
  </section>
  
</footer>



<script src="../../../public/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
<script type="text/javascript" src="../../../wp-content/themes/hueman/js/jquery.jplayer.min.js"></script>
<script type="text/javascript" src="../../../wp-content/themes/hueman/js/scripts.js"></script>
<script type="text/javascript" src="../../../assets/picturefill/picturefill.min.js"></script>
<script type="text/javascript" src="../../../assets/js/jquery.matchHeight-min.js"></script>
<script type="text/javascript" async defer src="../../../assets/js/myblog.js"></script>

</body>
</html>

