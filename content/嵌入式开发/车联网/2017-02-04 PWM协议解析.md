---
title: PWM协议解析
date: 2017-02-04T02:13:53+08:00
update: 2017-02-04 02:13:53
categories:
tags:
---

SAEJ1850 PWM协议也是OBD II标准中的一种，通常应用在FORD车系汽车中，已知的还有JAGUAR，MAZDA。PWM英文全称是Pulse Width Modulation，即脉宽调制。下面从物理层特性、帧结构、命令交互、交互时间参数、常用命令字等几个方面来介绍这种协议。

Ø  物理层特性：波特率为41.7kbps；线路物理特性：双线，双向，半双工（差分信号）。通信电平通常为12V。数据位描述，位1见图2-3-1，位0见图2-3-2：
![](http://www.dpfdoctor.net/upLoad/news/month_1401/201401031036106384.png)

图2-3-1
![](http://www.dpfdoctor.net/upLoad/news/month_1401/201401031036302143.png)

图2-3-2

时间参数定义如下：
TP1：常规为8us，取值范围，在发送命令中7<=TP1<=9，在接收命令时，6<=TP1<=11
TP2：常规为16us，取值范围，在发送命令中15<=TP1<=17，在接收命令时，14<=TP1<=19
TP3(一个位的时间长度)：常规为24us，取值范围，在发送命令中23<=TP1<=25.5，在接收命令时，22<=TP1<=27
图2-3-3是MAZDA原厂设备IDS系统进入命令的一部分波形
![](http://www.dpfdoctor.net/upLoad/news/month_1401/201401031036381863.png)
图2-3-3

Ø  帧结构：命令头（3个字节）+ 数据区 + CRC校验。一帧命令最长为12个字节。
在命令头中，包括以下几个部分的内容：格式字节(C4H)+目标地址+源地址。
请参见图2-3-4和图2-3-5
![](http://www.dpfdoctor.net/upLoad/news/month_1401/201401031036486852.png)

                                                 图2-3-4
![](http://www.dpfdoctor.net/upLoad/news/month_1401/201401031036565651.png)
                                                        图2-3-5
TP4：SOF（帧起始标志）时间，常规为48us，取值范围，发送时47<=TP4<=51,接收时46<=TP4<=63
TP5：EOF（帧结束标志）时间，常规为72us，取值范围，发送时70<=TP5<=76.5，接收时TP5》=70
命令体的内容中：命令字+命令内容。命令内容可以没有。
举例如下：
C4H  10H  F5H  13H  C7H
第一个字节C4H为格式
第二个字节10H为目标地址
第三个字节F5H为源地址
第四个字节（PID，功能号）13H为命令字，表示系统读码
最后一个字节04H为前面4个字节的校验和

Ø  命令交互：命令交互通常情况下为1对1，但也存在1对多的情况。下面是一组命令交互举例：
Tools: C4H  10H  F5H  22H  11H  00H  3BH
Ecu:   C4H  F5H  10H  62H  11H  00H  09H  FFH  00H  00H  6AH
在交互中，因为发送命令的对象不一样，所以目标地址和源地址是进行了互换；同时，ECU响应设备的命令字在设备命令字的基础上+0x40
注：无链路保持。
Ø  常用命令字：
读故障码：13H
清除故障码：14H
读数据流：22H
读版本信息：1AH
